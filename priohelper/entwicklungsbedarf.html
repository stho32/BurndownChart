<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Entwicklungsbedarf-Helper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-size: 14px;
        }
        .container-fluid {
            padding: 20px;
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .form-label {
            margin-bottom: 0.15rem;
        }
        .form-select, .form-check-input, .form-check-label {
            font-size: 0.8rem;
        }
        .mb-3 {
            margin-bottom: 0.5rem !important;
        }
        #entwicklungsbedarfChart {
            max-height: 400px;
            width: 100%;
        }
        .input-column, .result-column {
            height: calc(100vh - 100px);
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1>Entwicklungsbedarf-Helper</h1>
        
        <form id="entwicklungsbedarfForm">
            <div class="row">
                <div class="col-md-6 input-column">
                    <div class="mb-3">
                        <label for="effizienzsteigerung" class="form-label"><strong>Effizienzsteigerung</strong></label>
                        <input type="number" id="effizienzsteigerung" min="0" max="160" value="0" oninput="updateEntwicklungsbedarfAndChart()">
                        <span id="effizienzsteigerungDisplay">0</span> Stunden pro Monat
                    </div>
                    
                    <div class="mb-3">
                        <label for="benutzerfreundlichkeit" class="form-label"><strong>Benutzerfreundlichkeit</strong></label>
                        <select name="benutzerfreundlichkeit" id="benutzerfreundlichkeit" class="form-select">
                            <option value="1">Sehr gut</option>
                            <option value="3">Gut</option>
                            <option value="5">Mittel</option>
                            <option value="7">Schlecht</option>
                            <option value="10">Sehr schlecht</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="performance">Performance (Wartezeit in Sekunden):</label>
                        <input type="range" id="performance" min="2" max="30" value="2" step="1" oninput="updateEntwicklungsbedarfAndChart()">
                        <span id="performanceDisplay">2</span> Sekunden
                    </div>

                    <div class="mb-3">
                        <label for="fehlerhaeufigkeit" class="form-label"><strong>Fehlerhäufigkeit</strong></label>
                        <select name="fehlerhaeufigkeit" id="fehlerhaeufigkeit" class="form-select">
                            <option value="1">Sehr selten</option>
                            <option value="3">Selten</option>
                            <option value="5">Gelegentlich</option>
                            <option value="7">Häufig</option>
                            <option value="10">Sehr häufig</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="fehleraufwand" class="form-label"><strong>Durchschn. Fehleraufwand pro Fall</strong></label>
                        <select name="fehleraufwand" id="fehleraufwand" class="form-select">
                            <option value="1">Sehr gering</option>
                            <option value="3">Gering</option>
                            <option value="5">Mittel</option>
                            <option value="7">Hoch</option>
                            <option value="10">Sehr hoch</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="deadEnd" class="form-label"><strong>Dead End (z.B. Lieferant stellt kritische Technologie ein)</strong></label>
                        <select name="deadEnd" id="deadEnd" class="form-select">
                            <option value="1">Kein Risiko</option>
                            <option value="3">Geringes Risiko</option>
                            <option value="5">Mittleres Risiko</option>
                            <option value="7">Hohes Risiko</option>
                            <option value="10">Sehr hohes Risiko</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="verdientesGeld" class="form-label"><strong>Verdientes Geld pro Monat</strong></label>
                        <select name="verdientesGeld" id="verdientesGeld" class="form-select">
                            <option value="1">0 - 1.000 EUR</option>
                            <option value="3">1.001 - 5.000 EUR</option>
                            <option value="5">5.001 - 10.000 EUR</option>
                            <option value="7">10.001 - 50.000 EUR</option>
                            <option value="10">&gt; 50.000 EUR</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-6 result-column">
                    <div class="mb-4">
                        <p>Der Entwicklungsbedarf beträgt: <strong id="entwicklungsbedarfDisplay"></strong></p>
                    </div>
                    <div>
                        <canvas id="entwicklungsbedarfChart"></canvas>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        const ctx = document.getElementById('entwicklungsbedarfChart').getContext('2d');
        let entwicklungsbedarfChart;

        function updateEntwicklungsbedarfAndChart() {
            const effizienzsteigerung = parseInt(document.getElementById('effizienzsteigerung').value);
            const benutzerfreundlichkeit = parseInt(document.getElementById('benutzerfreundlichkeit').value);
            const performance = parseInt(document.getElementById('performance').value);
            const fehlerhaeufigkeit = parseInt(document.getElementById('fehlerhaeufigkeit').value);
            const fehleraufwand = parseInt(document.getElementById('fehleraufwand').value);
            const deadEnd = parseInt(document.getElementById('deadEnd').value);
            const verdientesGeld = parseInt(document.getElementById('verdientesGeld').value);

            // Convert efficiency hours to 1-10 scale
            const effizienzsteigerungFaktor = Math.min(Math.ceil(effizienzsteigerung / 16), 10);

            // Convert performance (wait time) to 1-10 scale
            const performanceFaktor = Math.min(Math.ceil((performance - 1) / 3), 10);

            // Calculate Entwicklungsbedarf
            const entwicklungsbedarf = 
                effizienzsteigerungFaktor *
                benutzerfreundlichkeit *
                performanceFaktor *
                fehlerhaeufigkeit *
                fehleraufwand *
                deadEnd *
                (11 - verdientesGeld);

            // Update Entwicklungsbedarf display
            document.getElementById('entwicklungsbedarfDisplay').textContent = entwicklungsbedarf.toFixed(2);

            // Update Effizienzsteigerung display
            document.getElementById('effizienzsteigerungDisplay').textContent = effizienzsteigerung;

            // Update Performance display
            document.getElementById('performanceDisplay').textContent = performance;

            // Update chart
            updateChart(effizienzsteigerungFaktor, benutzerfreundlichkeit, performanceFaktor, fehlerhaeufigkeit, fehleraufwand, deadEnd, verdientesGeld);

            // Update URL
            updateURL();
        }

        function updateChart(effizienzsteigerung, benutzerfreundlichkeit, performance, fehlerhaeufigkeit, fehleraufwand, deadEnd, verdientesGeld) {
            const data = [effizienzsteigerung, benutzerfreundlichkeit, performance, fehlerhaeufigkeit, fehleraufwand, deadEnd, verdientesGeld];
            if (entwicklungsbedarfChart) {
                entwicklungsbedarfChart.data.datasets[0].data = data;
                entwicklungsbedarfChart.update();
            } else {
                entwicklungsbedarfChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Effizienzsteigerung', 'Benutzerfreundlichkeit', 'Performance', 'Fehlerhäufigkeit', 'Fehleraufwand', 'Dead End', 'Verdientes Geld'],
                        datasets: [{
                            label: 'Entwicklungsbedarf',
                            data: data,
                            fill: true,
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            pointBackgroundColor: 'rgba(75, 192, 192, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(75, 192, 192, 1)'
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 10
                            }
                        }
                    }
                });
            }
        }

        function updateURL() {
            const form = document.getElementById('entwicklungsbedarfForm');
            const formData = new FormData(form);
            const searchParams = new URLSearchParams(formData);
            const newUrl = `${window.location.pathname}?${searchParams.toString()}`;
            window.history.pushState({}, '', newUrl);
        }

        function setInitialValues() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Set select inputs
            ['effizienzsteigerung', 'benutzerfreundlichkeit', 'performance', 'fehlerhaeufigkeit', 'fehleraufwand', 'deadEnd', 'verdientesGeld'].forEach(param => {
                const value = urlParams.get(param);
                if (value) {
                    document.getElementById(param).value = value;
                }
            });

            // Update Entwicklungsbedarf and chart after setting initial values
            updateEntwicklungsbedarfAndChart();
        }

        // Call setInitialValues when the page loads
        document.addEventListener('DOMContentLoaded', setInitialValues);

        // Automated Entwicklungsbedarf and chart update on change
        document.querySelectorAll('select').forEach(element => {
            element.addEventListener('change', updateEntwicklungsbedarfAndChart);
        });
    </script>
</body>
</html>