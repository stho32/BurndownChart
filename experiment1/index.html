<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burndown Chart</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <div id="chart"></div>
    <script>
        google.charts.load('current', { "packages": ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);

        const pixelsPerTask = 10;
        const pixelsPerDay = 20;
        // Configuration data
        const numTasks = 40;
        const startDate = new Date(2024, 5, 3);
        const endDate = new Date(2024, 6, 25);
        const chartHeight = numTasks * pixelsPerTask;
        const numDays = (endDate - startDate) / (1000 * 60 * 60 * 24) + 1;
        const chartWidth = numDays * pixelsPerDay;

        // Setting the chart size
        document.getElementById('chart').style.width = `${chartWidth}px`;
        document.getElementById('chart').style.height = `${chartHeight}px`;

        // Function to add a vertical bar with text
        function addVerticalBar(svg, cli, chartArea, date, text, color) {
            var x = cli.getXLocation(date);
            var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x);
            line.setAttribute('x2', x);
            line.setAttribute('y1', chartArea.top);
            line.setAttribute('y2', chartArea.top + chartArea.height);
            line.setAttribute('stroke', color);
            line.setAttribute('stroke-width', 2);
            svg.appendChild(line);

            var label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', x + 5);
            label.setAttribute('y', chartArea.top + 20);
            label.setAttribute('fill', color);
            label.textContent = text;
            svg.appendChild(label);
        }

        // Function to add vertical gridlines for each Monday
        function addWeekMarkers(svg, cli, chartArea, startDate, endDate) {
            var firstMonday = new Date(startDate);
            while (firstMonday.getDay() !== 1) {
                firstMonday.setDate(firstMonday.getDate() + 1);
            }

            var currentMonday = new Date(firstMonday);
            while (currentMonday <= endDate) {
                var x = cli.getXLocation(currentMonday);
                var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('x2', x);
                line.setAttribute('y1', chartArea.top);
                line.setAttribute('y2', chartArea.top + chartArea.height);
                line.setAttribute('stroke', '#cccccc');
                line.setAttribute('stroke-width', 1);
                svg.appendChild(line);

                currentMonday.setDate(currentMonday.getDate() + 7); // Move to the next Monday
            }
        }

        function drawChart() {
            // Data for the chart
            var data = google.visualization.arrayToDataTable([
                ["Date", "What's next tasks remaining", "Total Tasks Remaining", { type: "string", role: "annotation" }],
                [new Date(2024, 5, 3), 23, null, "start"],
                [new Date(2024, 5, 4), 15, null, null],
                [new Date(2024, 5, 5), 20, null, null],
                [new Date(2024, 5, 6), 17, null, null],
                [new Date(2024, 5, 7), 18, 36, null],
                [new Date(2024, 5, 8), 18, 36, null],
                [new Date(2024, 5, 9), 18, 36, null],
                [new Date(2024, 5, 10), 18, 36, null],
                [new Date(2024, 5, 11), 21, 39, null],
                [new Date(2024, 5, 12), 18, 35, null],
                [new Date(2024, 5, 13), 16, 33, null],
                [new Date(2024, 5, 14), 15, 37, null],
                [new Date(2024, 5, 15), 15, 37, null],
                [new Date(2024, 5, 16), 15, 37, null],
                [new Date(2024, 5, 17), null, null, null],
                [new Date(2024, 5, 18), null, null, null],
                [new Date(2024, 5, 19), null, null, null],
                [new Date(2024, 5, 20), null, null, null],
                [new Date(2024, 5, 21), null, null, "deadline"],
            ]);

            var options = {
                title: 'Project Burndown Chart',
                hAxis: {
                    title: 'Date',
                    format: 'MMM dd',
                    viewWindow: {
                        min: startDate,
                        max: endDate
                    },
                    gridlines: {
                        color: 'transparent',
                    },
                    minorGridlines: {
                        count: 1
                    }
                },
                vAxis: {
                    title: 'Tasks',
                    viewWindow: {
                        min: 0,
                        max: numTasks
                    },
                    gridlines: {
                        count: numTasks + 1
                    },
                    minorGridlines: {
                        count: 0
                    }
                },
                legend: {
                    position: 'top'
                },
                interpolateNulls: true,
                trendlines: {
                    0: {
                        type: 'linear',
                        color: 'green',
                        lineWidth: 2,
                        opacity: 0.3,
                        showR2: true,
                        visibleInLegend: true,
                        labelInLegend: 'Trendline: What\'s next tasks'
                    },
                    1: {
                        type: 'linear',
                        color: 'blue',
                        lineWidth: 2,
                        opacity: 0.3,
                        showR2: true,
                        visibleInLegend: true,
                        labelInLegend: 'Trendline: Total tasks'
                    }
                },
                series: {
                    0: { color: 'orange', labelInLegend: "What's next tasks remaining" },
                    1: { color: 'blue', labelInLegend: "Total tasks remaining" }
                }
            };

            var chartDiv = document.getElementById('chart');
            var chart = new google.visualization.LineChart(chartDiv);

            // Draw the chart with annotations
            google.visualization.events.addListener(chart, 'ready', function () {
                var cli = chart.getChartLayoutInterface();
                var chartArea = cli.getChartAreaBoundingBox();
                var svg = chart.getContainer().getElementsByTagName('svg')[0];

                addWeekMarkers(svg, cli, chartArea, startDate, endDate);
                addVerticalBar(svg, cli, chartArea, new Date(2024, 6, 16), "Jens's presentation", 'red');
            });

            chart.draw(data, options);
        }
    </script>
</body>

</html>
